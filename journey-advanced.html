<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Health Intelligence Dashboard — Unlimitr</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --green: #0F9D58;
      --amber: #E89B2C;
      --red: #D93025;
      --dark: #1A1A1A;
      --muted: #5F6368;
      --glass: rgba(255,255,255,0.65);
      --glass-border: rgba(255,255,255,0.4);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Outfit', -apple-system, sans-serif;
      background: linear-gradient(180deg, #f0f7f4 0%, #fff 30%);
      min-height: 100vh;
      overflow-x: hidden;
      color: var(--dark);
      padding-bottom: 100px;
    }
    .app-shell { max-width: 1100px; margin: 0 auto; padding: 0 24px; }

    /* 1. Hero Intelligence Strip */
    .hero-strip {
      position: relative;
      padding: 48px 32px 56px;
      border-radius: 28px;
      margin-bottom: 40px;
      overflow: hidden;
    }
    .hero-strip::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse 80% 60% at 70% 40%, rgba(15,157,88,0.08) 0%, transparent 60%);
      pointer-events: none;
    }
    .hero-strip::after {
      content: "";
      position: absolute;
      inset: 0;
      background: var(--glass);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      border: 1px solid var(--glass-border);
      border-radius: 28px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.04);
      pointer-events: none;
    }
    .hero-inner {
      position: relative;
      z-index: 1;
      display: grid;
      grid-template-columns: 1fr;
      gap: 32px;
      align-items: center;
    }
    @media (min-width: 768px) {
      .hero-inner { grid-template-columns: 1fr auto; }
    }
    .hero-content h1 {
      font-size: 1.85rem;
      font-weight: 700;
      color: var(--dark);
      margin-bottom: 8px;
      letter-spacing: -0.02em;
    }
    .hero-subtext {
      font-size: 0.95rem;
      color: var(--muted);
      line-height: 1.5;
      margin-bottom: 24px;
    }
    .hero-ctas {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }
    .btn-primary {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 14px 26px;
      background: var(--green);
      color: #fff;
      font-size: 0.95rem;
      font-weight: 600;
      border: none;
      border-radius: 14px;
      cursor: pointer;
      text-decoration: none;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 24px rgba(15,157,88,0.35);
      color: #fff;
    }
    .btn-secondary {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 14px 26px;
      background: transparent;
      color: var(--dark);
      font-size: 0.95rem;
      font-weight: 600;
      border: 1.5px solid rgba(26,26,26,0.2);
      border-radius: 14px;
      cursor: pointer;
      text-decoration: none;
      transition: border-color 0.2s ease, background 0.2s ease;
    }
    .btn-secondary:hover { border-color: var(--dark); background: rgba(26,26,26,0.03); color: var(--dark); }

    .hero-gauge-wrap {
      position: relative;
      width: 220px;
      height: 140px;
    }
    .hero-gauge-svg {
      width: 100%;
      height: 100%;
      filter: drop-shadow(0 4px 12px rgba(15,157,88,0.15));
    }
    .hero-gauge-bg { stroke: rgba(0,0,0,0.06); }
    .hero-gauge-fill {
      stroke-linecap: round;
      transition: stroke-dasharray 1.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .hero-score-center {
      position: absolute;
      bottom: 12px;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
    }
    .hero-score-num { font-size: 2.5rem; font-weight: 700; color: var(--dark); letter-spacing: -0.03em; }
    .hero-score-status { font-size: 0.8rem; font-weight: 600; color: var(--muted); margin-top: 2px; }
    .hero-score-sub { font-size: 0.7rem; color: var(--muted); margin-top: 4px; opacity: 0.9; }

    /* 2. Intelligence Driver Cards */
    .section-title {
      font-size: 1.15rem;
      font-weight: 700;
      color: var(--dark);
      margin-bottom: 20px;
    }
    .driver-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-bottom: 40px;
    }
    @media (min-width: 768px) {
      .driver-grid { grid-template-columns: repeat(3, 1fr); }
    }
    .driver-card {
      background: var(--glass);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      border: 1px solid var(--glass-border);
      border-radius: 28px;
      padding: 24px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.04);
      transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
      opacity: 0;
    }
    .driver-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(0,0,0,0.08);
      border-color: rgba(255,255,255,0.6);
    }
    .driver-card.risk-high:hover { box-shadow: 0 12px 40px rgba(217,48,37,0.12); }
    .driver-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .driver-card-title { font-size: 0.85rem; font-weight: 700; color: var(--dark); }
    .driver-status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }
    .driver-mini-gauge {
      width: 72px;
      height: 44px;
      margin: 0 auto 12px;
    }
    .driver-value { font-size: 1.25rem; font-weight: 700; text-align: center; margin-bottom: 8px; }
    .driver-desc { font-size: 0.78rem; line-height: 1.5; color: var(--muted); }

    /* 3. Biological Impact */
    .body-panel {
      background: var(--glass);
      backdrop-filter: blur(14px);
      border: 1px solid var(--glass-border);
      border-radius: 28px;
      padding: 40px;
      margin-bottom: 40px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.04);
      position: relative;
    }
    .body-silhouette-wrap {
      width: 160px;
      height: 300px;
      margin: 0 auto 24px;
      position: relative;
    }
    .body-silhouette-wrap svg {
      width: 100%;
      height: 100%;
    }
    .body-region {
      transition: fill 0.35s ease, filter 0.35s ease;
    }
    .body-region.highlight {
      fill: rgba(217,48,37,0.25);
      filter: drop-shadow(0 0 12px rgba(217,48,37,0.3));
    }
    .body-region.highlight.pulse {
      animation: body-pulse 1.5s ease-in-out infinite;
    }
    @keyframes body-pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    .body-tooltip {
      text-align: center;
      font-size: 0.85rem;
      color: var(--muted);
      line-height: 1.5;
      min-height: 2.5em;
    }

    /* 4. Strategic Trajectory */
    .trajectory-panel {
      background: var(--glass);
      backdrop-filter: blur(14px);
      border: 1px solid var(--glass-border);
      border-radius: 28px;
      padding: 32px;
      margin-bottom: 40px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.04);
    }
    .graph-wrap { height: 220px; margin-bottom: 24px; }
    .trajectory-copy {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      font-size: 0.85rem;
      line-height: 1.6;
    }
    .trajectory-copy p { color: var(--muted); margin: 0; }
    .trajectory-copy p strong { color: var(--dark); }

    /* 5. Behavioral Heatmap */
    .heatmap-panel {
      background: var(--glass);
      backdrop-filter: blur(14px);
      border: 1px solid var(--glass-border);
      border-radius: 28px;
      padding: 32px;
      margin-bottom: 40px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.04);
    }
    .heatmap-explanation {
      font-size: 0.9rem;
      line-height: 1.6;
      color: var(--muted);
      margin-bottom: 20px;
    }
    .heatmap-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 10px;
    }
    .heatmap-cell {
      aspect-ratio: 1;
      border-radius: 12px;
      background: rgba(232,155,44,0.15);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      opacity: 0;
    }
    .heatmap-cell.risk-low { background: rgba(15,157,88,0.15); }
    .heatmap-cell.risk-moderate { background: rgba(232,155,44,0.2); }
    .heatmap-cell.risk-high { background: rgba(217,48,37,0.15); }
    .heatmap-cell:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 16px rgba(0,0,0,0.08);
    }

    /* 6. Transformation Timeline */
    .timeline-panel {
      background: var(--glass);
      backdrop-filter: blur(14px);
      border: 1px solid var(--glass-border);
      border-radius: 28px;
      padding: 40px;
      margin-bottom: 40px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.04);
    }
    .timeline-track {
      height: 6px;
      background: linear-gradient(90deg, rgba(15,157,88,0.15), rgba(15,157,88,0.35));
      border-radius: 6px;
      margin: 24px 0 40px;
      position: relative;
      overflow: visible;
    }
    .timeline-progress {
      height: 100%;
      border-radius: 4px;
      background: linear-gradient(90deg, var(--green), #0d8349);
      width: 0;
      transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .timeline-node {
      position: absolute;
      top: 50%;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--green);
      border: 3px solid #fff;
      transform: translate(-50%, -50%);
      box-shadow: 0 2px 8px rgba(15,157,88,0.4);
      transition: left 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .timeline-milestones {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
    }
    .timeline-milestone {
      text-align: center;
    }
    .timeline-milestone-icon {
      width: 40px;
      height: 40px;
      margin: 0 auto 8px;
      border-radius: 12px;
      background: rgba(15,157,88,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .timeline-milestone-icon svg { width: 20px; height: 20px; }
    .timeline-milestone-week { font-size: 0.8rem; font-weight: 700; color: var(--dark); margin-bottom: 2px; }
    .timeline-milestone-label { font-size: 0.75rem; color: var(--muted); }

    /* 7. Conversion Block */
    .conversion-block {
      background: linear-gradient(145deg, rgba(15,157,88,0.06) 0%, rgba(255,255,255,0.8) 100%);
      backdrop-filter: blur(14px);
      border: 1px solid rgba(15,157,88,0.15);
      border-radius: 28px;
      padding: 48px;
      text-align: center;
    }
    .conversion-block h2 { font-size: 1.5rem; font-weight: 700; color: var(--dark); margin-bottom: 16px; }
    .conversion-block p {
      font-size: 1rem;
      line-height: 1.7;
      color: var(--muted);
      max-width: 480px;
      margin: 0 auto 32px;
    }
    .conversion-ctas { display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; }

    .section { opacity: 0; }
  </style>
</head>
<body>
  <main class="app-shell">
    <!-- 1. Hero Intelligence Strip -->
    <section class="hero-strip section" id="heroSection">
      <div class="hero-inner">
        <div class="hero-content">
          <h1>Your Biological Intelligence Report</h1>
          <p class="hero-subtext">AI-structured metabolic and behavioral analysis based on your signals.</p>
          <div class="hero-ctas">
            <a href="#" class="btn-primary">Get My Personalized Solution</a>
            <button class="btn-secondary" id="downloadReportBtn">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
              Download Full Intelligence Report
            </button>
          </div>
        </div>
        <div class="hero-gauge-wrap">
          <svg class="hero-gauge-svg" viewBox="0 0 200 120">
            <defs>
              <linearGradient id="heroGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" stop-color="#D93025"/>
                <stop offset="50%" stop-color="#E89B2C"/>
                <stop offset="100%" stop-color="#0F9D58"/>
              </linearGradient>
            </defs>
            <path class="hero-gauge-bg" d="M 20 100 A 80 80 0 0 1 180 100" fill="none" stroke-width="8"/>
            <path id="heroGaugeFill" class="hero-gauge-fill" d="M 20 100 A 80 80 0 0 1 180 100" fill="none" stroke="url(#heroGrad)" stroke-width="8" stroke-dasharray="0 251"/>
          </svg>
          <div class="hero-score-center">
            <div id="heroScoreNum" class="hero-score-num">0</div>
            <div id="heroScoreStatus" class="hero-score-status">—</div>
            <div id="heroScoreSub" class="hero-score-sub">Reversible adaptive strain detected.</div>
          </div>
        </div>
      </div>
    </section>

    <!-- 2. Intelligence Driver Cards -->
    <section class="section" id="driverSection">
      <h2 class="section-title">Intelligence Driver Cards</h2>
      <div class="driver-grid" id="driverGrid"></div>
    </section>

    <!-- 3. Biological Impact Visualization -->
    <section class="section" id="bodySection">
      <h2 class="section-title">Biological Impact Analysis</h2>
      <div class="body-panel">
        <div class="body-silhouette-wrap">
          <svg viewBox="0 0 120 240" fill="none">
            <circle class="body-region" data-region="head" cx="60" cy="28" r="20" fill="#E8EAED" stroke="#DADCE0" stroke-width="0.5"/>
            <path class="body-region" data-region="torso" d="M44 50h32l4 55H40z" fill="#E8EAED" stroke="#DADCE0" stroke-width="0.5"/>
            <path class="body-region" data-region="abdomen" d="M48 102h24l2 42H46z" fill="#E8EAED" stroke="#DADCE0" stroke-width="0.5"/>
            <rect class="body-region" data-region="legs" x="50" y="144" width="10" height="76" rx="3" fill="#E8EAED" stroke="#DADCE0"/>
            <rect class="body-region" data-region="legs" x="60" y="144" width="10" height="76" rx="3" fill="#E8EAED" stroke="#DADCE0"/>
          </svg>
        </div>
        <div id="bodyTooltip" class="body-tooltip">Hover a driver card to see body impact.</div>
      </div>
    </section>

    <!-- 4. Strategic Trajectory Simulation -->
    <section class="section" id="trajectorySection">
      <h2 class="section-title">Strategic Trajectory Simulation</h2>
      <div class="trajectory-panel">
        <div class="graph-wrap">
          <canvas id="trajectoryChart"></canvas>
        </div>
        <div class="trajectory-copy">
          <p><strong>If no structured intervention:</strong> plateau risk in 6 weeks.</p>
          <p><strong>With guided intervention:</strong> sustainable fat reduction over 12 weeks.</p>
        </div>
      </div>
    </section>

    <!-- 5. Behavioral Prediction Heatmap -->
    <section class="section" id="heatmapSection">
      <h2 class="section-title">Behavioral Prediction Heatmap</h2>
      <div class="heatmap-panel">
        <p class="heatmap-explanation">Drop-off risk increases in weeks 3–4 without accountability.</p>
        <div class="heatmap-grid" id="heatmapGrid"></div>
      </div>
    </section>

    <!-- 6. Transformation Timeline -->
    <section class="section" id="timelineSection">
      <h2 class="section-title">Transformation Timeline</h2>
      <div class="timeline-panel">
        <div class="timeline-track">
          <div id="timelineProgress" class="timeline-progress"></div>
          <div id="timelineNode" class="timeline-node" style="left: 0;"></div>
        </div>
        <div class="timeline-milestones" id="timelineMilestones"></div>
      </div>
    </section>

    <!-- 7. Authority Conversion Block -->
    <section class="section" id="conversionSection">
      <div class="conversion-block">
        <h2>Your System Is Recoverable</h2>
        <p>This is adaptive strain — not permanent damage. Structured correction restores resilience.</p>
        <div class="conversion-ctas">
          <a href="#" class="btn-primary">Activate My Personalized Plan</a>
          <button class="btn-secondary" id="downloadReportBtn2">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            Download Report
          </button>
        </div>
      </div>
    </section>
  </main>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    (function() {
      "use strict";
      function loadData() {
        try {
          var r = localStorage.getItem("assessmentData") || sessionStorage.getItem("assessmentData");
          if (r) return JSON.parse(r);
        } catch (e) {}
        return { weight: 78, height: 172, age: 30, gender: "male", targetWeight: 70, activityLevel: "moderate", sleepQuality: "good", stressLevel: "moderate", commitment: "4-5" };
      }
      function calcScore(d) {
        var w = parseFloat(d.weight) || 78, h = parseFloat(d.height) || 172;
        var bmi = w / ((h/100)*(h/100));
        var b = bmi <= 22.9 ? 100 : bmi <= 25 ? 80 : bmi <= 30 ? 60 : 40;
        var a = (d.activityLevel || "").toLowerCase();
        var aSc = a === "high" ? 100 : a === "moderate" ? 80 : a === "light" ? 60 : 40;
        var s = (d.sleepQuality || "").toLowerCase();
        var sSc = s === "restorative" ? 100 : s === "good" ? 90 : s === "inconsistent" ? 60 : 40;
        var st = (d.stressLevel || "").toLowerCase();
        var stSc = st === "low" ? 100 : st === "moderate" ? 70 : st === "high" ? 40 : 20;
        return Math.round(Math.max(20, Math.min(100, 0.3*b + 0.2*aSc + 0.2*sSc + 0.2*stSc)));
      }
      function getStatus(s) { return s >= 85 ? "Resilient" : s >= 70 ? "Optimizing" : s >= 50 ? "Moderate" : "Strained"; }
      function getColor(s) { return s >= 70 ? "#0F9D58" : s >= 50 ? "#E89B2C" : "#D93025"; }

      var data = loadData();
      var score = calcScore(data);
      var status = getStatus(score);
      var subCopy = score < 50 ? "Reversible adaptive strain detected." : score < 70 ? "Structured accountability recommended." : "Projected improvement: +51% with adherence.";

      document.getElementById("heroScoreStatus").textContent = status;
      document.getElementById("heroScoreSub").textContent = subCopy;

      gsap.registerPlugin(ScrollTrigger);
      var circ = Math.PI * 80;
      var dash = (score/100) * circ;
      gsap.fromTo("#heroGaugeFill", { strokeDasharray: "0 " + circ }, { strokeDasharray: dash + " " + circ, duration: 1.2, ease: "power2.out" });
      var obj = { v: 0 };
      gsap.to(obj, { v: score, duration: 1, ease: "power2.out", snap: { v: 1 }, onUpdate: function() { document.getElementById("heroScoreNum").textContent = Math.round(obj.v); } });

      gsap.fromTo("#heroSection", { opacity: 0, y: 16 }, { opacity: 1, y: 0, duration: 0.8, ease: "power2.out" });

      var drivers = [
        { key: "BMI", score: data.weight && data.height ? Math.min(100, 100 - Math.abs((data.weight/((data.height/100)**2) - 22)*3)) : 70, desc: "Body composition signals suggest optimization potential. Targeted nutrition can improve efficiency.", region: "torso" },
        { key: "Metabolic Age", score: 75, desc: "Cellular energy utilization patterns indicate room for improvement. Structured training enhances mitochondrial function.", region: "torso" },
        { key: "Risk Index", score: Math.max(0, 100 - score), colorScore: score, desc: "Primary levers identified. Corrective intervention can reduce strain and accelerate recovery.", region: "abdomen" },
        { key: "Recovery", score: data.sleepQuality === "good" ? 82 : 58, desc: "Sleep and stress load affect fat oxidation. Recovery optimization can accelerate progress by 22%.", region: "head" },
        { key: "Hormonal Balance", score: data.stressLevel === "moderate" ? 68 : 52, desc: "Signals indicate mild insulin inefficiency. Meal timing and resistance training normalize response.", region: "abdomen" },
        { key: "Behavioral Stability", score: data.commitment ? 74 : 55, desc: "Consistency is a primary lever. Structured programming addresses plateaus effectively.", region: "legs" }
      ];

      var arcPath = 'M 8 36 A 28 28 0 0 1 52 36';
      var arcLen = Math.PI * 28;
      var grid = document.getElementById("driverGrid");
      drivers.forEach(function(d, i) {
        var cs = d.colorScore !== undefined ? d.colorScore : d.score;
        var inv = d.key === "Risk Index";
        var pct = Math.min(100, Math.max(0, inv ? (100 - d.score) : d.score));
        var c = getColor(inv ? (100 - d.score) : d.score);
        var card = document.createElement("div");
        card.className = "driver-card" + (d.score < 50 ? " risk-high" : "");
        card.dataset.region = d.region;
        card.dataset.tooltip = d.region === "abdomen" ? "Elevated stress → Cortisol load → Abdominal fat retention" : d.region === "head" ? "Sleep deficit → Cortisol elevation → Recovery impairment" : d.region === "torso" ? "Metabolic inefficiency → Energy partitioning" : "Activity deficit → Muscle protein turnover";
        card.dataset.pulse = d.score < 50 ? "1" : "0";
        card.innerHTML = '<div class="driver-card-header"><span class="driver-card-title">' + d.key + '</span><span class="driver-status-dot" style="background:' + c + '"></span></div>' +
          '<svg class="driver-mini-gauge" viewBox="0 0 60 44"><path d="' + arcPath + '" fill="none" stroke="rgba(0,0,0,0.06)" stroke-width="5"/><path class="dr-fill" d="' + arcPath + '" fill="none" stroke="' + c + '" stroke-width="5" stroke-linecap="round" stroke-dasharray="0 ' + arcLen + '"/></svg>' +
          '<div class="driver-value" style="color:' + c + '">' + Math.round(pct) + '%</div>' +
          '<div class="driver-desc">' + d.desc + '</div>';
        grid.appendChild(card);

        var fill = card.querySelector(".dr-fill");
        var dl = (pct/100) * arcLen;
        gsap.fromTo(fill, { strokeDasharray: "0 " + arcLen }, { strokeDasharray: dl + " " + arcLen, duration: 0.9, delay: 0.1 + i*0.06, ease: "power2.out" });
      });
      gsap.to(".driver-card", { opacity: 1, duration: 0.6, stagger: 0.05, ease: "power2.out", scrollTrigger: { trigger: "#driverSection", start: "top 88%" } });

      var bodyRegions = document.querySelectorAll(".body-region");
      var bodyTooltip = document.getElementById("bodyTooltip");
      document.querySelectorAll(".driver-card").forEach(function(card) {
        card.addEventListener("mouseenter", function() {
          var r = this.dataset.region;
          var pulse = this.dataset.pulse === "1";
          bodyRegions.forEach(function(br) {
            var match = br.dataset.region === r;
            br.classList.toggle("highlight", match);
            br.classList.toggle("pulse", match && pulse);
          });
          bodyTooltip.textContent = this.dataset.tooltip || "";
        });
        card.addEventListener("mouseleave", function() {
          bodyRegions.forEach(function(br) { br.classList.remove("highlight", "pulse"); });
          bodyTooltip.textContent = "Hover a driver card to see body impact.";
        });
      });

      var ctx = document.getElementById("trajectoryChart");
      if (ctx && typeof Chart !== "undefined") {
        var labels = ["W0","W2","W4","W6","W8","W10","W12"];
        var cur = [78, 77.4, 77, 76.7, 76.5, 76.4, 76.3];
        var cor = [78, 76.5, 74.8, 73.2, 71.5, 70.2, 70];
        new Chart(ctx, {
          type: "line",
          data: {
            labels: labels,
            datasets: [
              { label: "Current Path", data: cur, borderColor: "#D93025", backgroundColor: "transparent", fill: false, tension: 0.4, borderWidth: 2, borderDash: [6, 4], pointRadius: 3, pointBackgroundColor: "#D93025" },
              { label: "Corrected Path", data: cor, borderColor: "#0F9D58", backgroundColor: "rgba(15,157,88,0.1)", fill: true, tension: 0.4, borderWidth: 2, pointRadius: 3, pointBackgroundColor: "#0F9D58" }
            ]
          },
          options: {
            responsive: true,
            animation: { duration: 1100 },
            plugins: { legend: { position: "bottom" } },
            scales: { y: { beginAtZero: false, grid: { color: "rgba(0,0,0,0.06)" } }, x: { grid: { color: "rgba(0,0,0,0.06)" } } }
          }
        });
      }

      var hmData = [0,0,2,2,0,0,1,0,0,0,0,0];
      var hg = document.getElementById("heatmapGrid");
      for (var i = 0; i < 12; i++) {
        var cell = document.createElement("div");
        cell.className = "heatmap-cell risk-" + (hmData[i] === 2 ? "high" : hmData[i] === 1 ? "moderate" : "low");
        cell.title = "Week " + (i+1);
        hg.appendChild(cell);
      }
      gsap.to(".heatmap-cell", { opacity: 1, duration: 0.5, stagger: 0.04, ease: "power2.out", scrollTrigger: { trigger: "#heatmapSection", start: "top 88%" } });

      var milestones = [
        { week: 2, label: "Metabolic Stabilization", icon: "M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" },
        { week: 4, label: "Recovery Optimization", icon: "M12 2v20M2 12h20" },
        { week: 8, label: "Hormonal Correction", icon: "M12 2a4 4 0 014 4v4a4 4 0 01-8 0V6a4 4 0 014-4z" },
        { week: 12, label: "Visible Composition Shift", icon: "M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" }
      ];
      var tm = document.getElementById("timelineMilestones");
      milestones.forEach(function(m) {
        var div = document.createElement("div");
        div.className = "timeline-milestone";
        div.innerHTML = '<div class="timeline-milestone-icon"><svg viewBox="0 0 24 24" fill="none" stroke="' + (m.week === 12 ? "#0F9D58" : "#5F6368") + '" stroke-width="2"><path d="' + m.icon + '"/></svg></div><div class="timeline-milestone-week">Week ' + m.week + '</div><div class="timeline-milestone-label">' + m.label + '</div>';
        tm.appendChild(div);
      });

      var tlProg = document.getElementById("timelineProgress");
      var tlNode = document.getElementById("timelineNode");
      ScrollTrigger.create({
        trigger: "#timelineSection",
        start: "top 85%",
        end: "top 20%",
        scrub: 0.5,
        onUpdate: function(self) {
          var p = self.progress;
          tlProg.style.width = (p * 100) + "%";
          tlNode.style.left = (p * 100) + "%";
        }
      });

      gsap.utils.toArray(".section").forEach(function(el, i) {
        if (el.id === "heroSection") return;
        gsap.fromTo(el, { opacity: 0, y: 24 }, { opacity: 1, y: 0, duration: 0.6, delay: 0.05 * i, ease: "power2.out", scrollTrigger: { trigger: el, start: "top 88%" } });
      });

      function doDownload() {
        var JSPDF = typeof jspdf !== "undefined" ? (jspdf.jsPDF || jspdf) : null;
        if (JSPDF) {
          var doc = new JSPDF();
          doc.setFont("helvetica");
          doc.setFontSize(20);
          doc.text("Health Intelligence Report", 20, 24);
          doc.setFontSize(11);
          doc.text("Metabolic Score: " + score + " (" + status + ")", 20, 36);
          doc.text("Summary: " + subCopy, 20, 46);
          doc.text("Risk Drivers: BMI, Metabolic Age, Recovery, Hormonal, Behavioral", 20, 56);
          doc.text("Trajectory: With intervention — sustainable fat reduction over 12 weeks.", 20, 66);
          doc.text("Milestones: W2 Metabolic Stabilization, W4 Recovery, W8 Hormonal, W12 Composition", 20, 76);
          doc.setFontSize(9);
          doc.text("Generated by Unlimitr AI Health Intelligence", 20, 280);
          doc.save("Unlimitr_Health_Report.pdf");
        }
      }
      document.getElementById("downloadReportBtn").addEventListener("click", doDownload);
      document.getElementById("downloadReportBtn2").addEventListener("click", doDownload);
    })();
  </script>
</body>
</html>
